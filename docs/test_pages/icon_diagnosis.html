<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” å›¾æ ‡é—®é¢˜è¯Šæ–­</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: system-ui, sans-serif;
            margin: 20px;
            line-height: 1.6;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .icon-test {
            font-size: 2rem;
            margin: 10px;
            display: inline-block;
        }
        .debug-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            margin: 10px 0;
        }
        .status-good { color: #28a745; }
        .status-bad { color: #dc3545; }
        .status-warning { color: #ffc107; }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ” å›¾æ ‡æ˜¾ç¤ºé—®é¢˜è¯Šæ–­</h1>
        
        <div class="section">
            <h2>ğŸ“Š å½“å‰çŠ¶æ€æ£€æµ‹</h2>
            <div id="status-info">æ­£åœ¨æ£€æµ‹...</div>
            <button class="btn" onclick="runFullDiagnosis()">ğŸ”§ å®Œæ•´è¯Šæ–­</button>
            <button class="btn" onclick="testFontAwesome()">ğŸ” æµ‹è¯•Font Awesome</button>
            <button class="btn" onclick="toggleIconMode()">ğŸ”„ åˆ‡æ¢å›¾æ ‡æ¨¡å¼</button>
        </div>

        <div class="section">
            <h2>ğŸ”§ Font Awesome å›¾æ ‡æµ‹è¯•</h2>
            <div class="icon-test">
                <i class="fas fa-home" title="é¦–é¡µ"></i>
                <i class="fas fa-chart-line" title="å›¾è¡¨"></i>
                <i class="fas fa-lightbulb" title="ç¯æ³¡"></i>
                <i class="fas fa-code" title="ä»£ç "></i>
                <i class="fas fa-heart" title="å¿ƒå½¢"></i>
                <i class="fas fa-user" title="ç”¨æˆ·"></i>
                <i class="fas fa-cog" title="è®¾ç½®"></i>
                <i class="fas fa-bell" title="é€šçŸ¥"></i>
            </div>
            <div id="fontawesome-status" class="debug-info">ç­‰å¾…æ£€æµ‹...</div>
        </div>

        <div class="section">
            <h2>ğŸ˜€ Emojiæ˜¾ç¤ºæµ‹è¯•</h2>
            <div class="icon-test">
                ğŸ  ğŸ“ˆ ğŸ’¡ ğŸ’» â¤ï¸ ğŸ‘¤ âš™ï¸ ğŸ””
            </div>
            <div id="emoji-status" class="debug-info">ç­‰å¾…æ£€æµ‹...</div>
        </div>

        <div class="section">
            <h2>ğŸ”¬ è¯¦ç»†æŠ€æœ¯ä¿¡æ¯</h2>
            <div id="tech-details" class="debug-info">æ”¶é›†ä¿¡æ¯ä¸­...</div>
        </div>

        <div class="section">
            <h2>ğŸ¯ é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2>
            <div id="solutions">
                <p>åŸºäºæ£€æµ‹ç»“æœï¼Œå°†æ˜¾ç¤ºç›¸åº”çš„è§£å†³æ–¹æ¡ˆ...</p>
            </div>
        </div>
    </div>

    <script>
        let iconFallbackActive = false;

        function checkFontAwesome() {
            // æ£€æŸ¥CSSé“¾æ¥
            const faLinks = document.querySelectorAll('link[href*="font-awesome"]');
            
            // æ£€æŸ¥å›¾æ ‡æ¸²æŸ“
            const testIcon = document.createElement('i');
            testIcon.className = 'fas fa-home';
            testIcon.style.cssText = 'position: absolute; opacity: 0;';
            document.body.appendChild(testIcon);
            
            const computed = window.getComputedStyle(testIcon, ':before');
            const content = computed.getPropertyValue('content');
            const fontFamily = computed.getPropertyValue('font-family');
            
            document.body.removeChild(testIcon);
            
            return {
                linksFound: faLinks.length,
                hasContent: content && content !== 'none' && content !== '""',
                content: content,
                fontFamily: fontFamily,
                isWorking: content && content !== 'none' && content !== '""'
            };
        }

        function checkEmoji() {
            // Canvasæµ‹è¯•
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 40;
            canvas.height = 40;
            
            ctx.font = '30px Arial';
            ctx.fillText('ğŸ“ˆ', 5, 30);
            
            const imageData = ctx.getImageData(0, 0, 40, 40);
            let hasPixels = false;
            
            for (let i = 3; i < imageData.data.length; i += 4) {
                if (imageData.data[i] > 0) {
                    hasPixels = true;
                    break;
                }
            }
            
            // DOMæµ‹è¯•
            const testEmoji = document.createElement('span');
            testEmoji.innerHTML = 'ğŸ“ˆ';
            testEmoji.style.cssText = 'position: absolute; top: -9999px; font-size: 50px;';
            document.body.appendChild(testEmoji);
            
            const emojiWidth = testEmoji.offsetWidth;
            const emojiHeight = testEmoji.offsetHeight;
            
            document.body.removeChild(testEmoji);
            
            return {
                canvasSupport: hasPixels,
                domWidth: emojiWidth,
                domHeight: emojiHeight,
                domSupport: emojiWidth > 30 && emojiHeight > 30
            };
        }

        function updateStatus() {
            const faCheck = checkFontAwesome();
            const emojiCheck = checkEmoji();
            
            // æ›´æ–°Font AwesomeçŠ¶æ€
            const faStatusHtml = `
                <strong>Font Awesome æ£€æµ‹ç»“æœ:</strong><br>
                CSSé“¾æ¥æ•°é‡: ${faCheck.linksFound}<br>
                å›¾æ ‡å†…å®¹: ${faCheck.content || 'æ— '}<br>
                å­—ä½“æ—: ${faCheck.fontFamily}<br>
                å·¥ä½œçŠ¶æ€: <span class="${faCheck.isWorking ? 'status-good' : 'status-bad'}">
                    ${faCheck.isWorking ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}
                </span>
            `;
            document.getElementById('fontawesome-status').innerHTML = faStatusHtml;
            
            // æ›´æ–°EmojiçŠ¶æ€
            const emojiStatusHtml = `
                <strong>Emoji æ£€æµ‹ç»“æœ:</strong><br>
                Canvasæ”¯æŒ: <span class="${emojiCheck.canvasSupport ? 'status-good' : 'status-bad'}">
                    ${emojiCheck.canvasSupport ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}
                </span><br>
                DOMæ¸²æŸ“: ${emojiCheck.domWidth}x${emojiCheck.domHeight}px<br>
                DOMæ”¯æŒ: <span class="${emojiCheck.domSupport ? 'status-good' : 'status-bad'}">
                    ${emojiCheck.domSupport ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}
                </span>
            `;
            document.getElementById('emoji-status').innerHTML = emojiStatusHtml;
            
            // æ›´æ–°æ€»ä½“çŠ¶æ€
            const hasIconFallback = document.body.classList.contains('icon-fallback-active');
            const statusHtml = `
                <p><strong>å›¾æ ‡å›é€€æ¨¡å¼:</strong> <span class="${hasIconFallback ? 'status-warning' : 'status-good'}">
                    ${hasIconFallback ? 'âš ï¸ å·²æ¿€æ´»' : 'âœ… æœªæ¿€æ´»'}
                </span></p>
                <p><strong>Font Awesome:</strong> <span class="${faCheck.isWorking ? 'status-good' : 'status-bad'}">
                    ${faCheck.isWorking ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}
                </span></p>
                <p><strong>Emojiæ”¯æŒ:</strong> <span class="${emojiCheck.domSupport ? 'status-good' : 'status-bad'}">
                    ${emojiCheck.domSupport ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}
                </span></p>
                <p><strong>æµè§ˆå™¨:</strong> ${navigator.userAgent.split(' ').pop()}</p>
                <p><strong>å¹³å°:</strong> ${navigator.platform}</p>
            `;
            document.getElementById('status-info').innerHTML = statusHtml;
            
            // æ›´æ–°æŠ€æœ¯è¯¦æƒ…
            const techHtml = `
                <strong>è¯¦ç»†æŠ€æœ¯ä¿¡æ¯:</strong><br>
                User Agent: ${navigator.userAgent}<br>
                Character Set: ${document.characterSet}<br>
                Font Awesome Links: ${faCheck.linksFound}<br>
                FA Content: ${faCheck.content}<br>
                FA Font Family: ${faCheck.fontFamily}<br>
                Body Classes: ${document.body.className}<br>
                Emoji Canvas: ${emojiCheck.canvasSupport}<br>
                Emoji DOM Size: ${emojiCheck.domWidth}x${emojiCheck.domHeight}<br>
            `;
            document.getElementById('tech-details').innerHTML = techHtml;
            
            // æ›´æ–°è§£å†³æ–¹æ¡ˆ
            generateSolutions(faCheck, emojiCheck, hasIconFallback);
        }

        function generateSolutions(faCheck, emojiCheck, hasIconFallback) {
            let solutions = [];
            
            if (!faCheck.isWorking && !emojiCheck.domSupport) {
                solutions.push('âŒ ä¸¥é‡é—®é¢˜ï¼šFont Awesomeå’ŒEmojiéƒ½æ— æ³•æ­£å¸¸æ˜¾ç¤º');
                solutions.push('ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œæ›´æ–°æµè§ˆå™¨');
            } else if (!faCheck.isWorking && emojiCheck.domSupport) {
                solutions.push('âš ï¸ Font AwesomeåŠ è½½å¤±è´¥ï¼Œä½†Emojiæ­£å¸¸');
                solutions.push('ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥Font Awesome CDNé“¾æ¥ï¼Œæˆ–ç»§ç»­ä½¿ç”¨Emojiå›é€€');
            } else if (faCheck.isWorking && !emojiCheck.domSupport) {
                solutions.push('âš ï¸ Font Awesomeæ­£å¸¸ï¼Œä½†Emojiæ˜¾ç¤ºå¼‚å¸¸');
                solutions.push('ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šå®‰è£…Emojiå­—ä½“åŒ…ï¼Œæˆ–ç¦ç”¨å›¾æ ‡å›é€€æ¨¡å¼');
            } else if (faCheck.isWorking && emojiCheck.domSupport) {
                if (hasIconFallback) {
                    solutions.push('âœ… ä¸¤ç§æ˜¾ç¤ºæ–¹å¼éƒ½æ­£å¸¸ï¼Œä½†å½“å‰å¤„äºå›é€€æ¨¡å¼');
                    solutions.push('ğŸ’¡ å»ºè®®ï¼šå¯ä»¥åˆ‡æ¢å›Font Awesomeæ¨¡å¼ä»¥è·å¾—æ›´å¥½çš„è§†è§‰æ•ˆæœ');
                } else {
                    solutions.push('âœ… ä¸€åˆ‡æ­£å¸¸ï¼Font Awesomeå’ŒEmojiéƒ½èƒ½æ­£å¸¸æ˜¾ç¤º');
                }
            }
            
            document.getElementById('solutions').innerHTML = 
                solutions.map(s => `<p>${s}</p>`).join('');
        }

        function runFullDiagnosis() {
            console.log('ğŸ” è¿è¡Œå®Œæ•´è¯Šæ–­...');
            updateStatus();
        }

        function testFontAwesome() {
            const result = checkFontAwesome();
            alert(`Font Awesomeæ£€æµ‹ç»“æœï¼š\né“¾æ¥æ•°é‡: ${result.linksFound}\nå·¥ä½œçŠ¶æ€: ${result.isWorking ? 'æ­£å¸¸' : 'å¼‚å¸¸'}\nå†…å®¹: ${result.content}`);
        }

        function toggleIconMode() {
            const hasClass = document.body.classList.contains('icon-fallback-active');
            if (hasClass) {
                document.body.classList.remove('icon-fallback-active');
                console.log('å·²ç§»é™¤å›¾æ ‡å›é€€æ¨¡å¼');
            } else {
                document.body.classList.add('icon-fallback-active');
                console.log('å·²å¯ç”¨å›¾æ ‡å›é€€æ¨¡å¼');
            }
            
            // æ·»åŠ CSSå›é€€è§„åˆ™
            if (!document.getElementById('icon-fallback-css')) {
                const style = document.createElement('style');
                style.id = 'icon-fallback-css';
                style.innerHTML = `
                    .icon-fallback-active i.fas::before,
                    .icon-fallback-active i.fa::before {
                        content: "" !important;
                        display: none !important;
                    }
                    .icon-fallback-active i.fas::after,
                    .icon-fallback-active i.fa::after {
                        font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif !important;
                        display: inline-block !important;
                    }
                    .icon-fallback-active i.fa-home::after { content: "ğŸ "; }
                    .icon-fallback-active i.fa-chart-line::after { content: "ğŸ“ˆ"; }
                    .icon-fallback-active i.fa-lightbulb::after { content: "ğŸ’¡"; }
                    .icon-fallback-active i.fa-code::after { content: "ğŸ’»"; }
                    .icon-fallback-active i.fa-heart::after { content: "â¤ï¸"; }
                    .icon-fallback-active i.fa-user::after { content: "ğŸ‘¤"; }
                    .icon-fallback-active i.fa-cog::after { content: "âš™ï¸"; }
                    .icon-fallback-active i.fa-bell::after { content: "ğŸ””"; }
                `;
                document.head.appendChild(style);
            }
            
            setTimeout(updateStatus, 200);
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œè¯Šæ–­
        window.addEventListener('load', function() {
            setTimeout(updateStatus, 1000);
        });
    </script>
</body>
</html>